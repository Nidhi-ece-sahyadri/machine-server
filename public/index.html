<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Machine Health Dashboard</title>
<style>
body { font-family: Arial; background: #f4f4f4; }
.container { width: 90%; max-width: 700px; margin: 40px auto; padding: 20px; background: #fff; border-radius:10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
h1 { text-align:center; }
.card { padding:15px 20px; margin:10px 0; border-radius:8px; background:#e9e9e9; }
.status-healthy { background:#c9ffd5; }
.status-warning { background:#fff6bf; }
.status-faulty { background:#ffcccc; }
.label { font-weight:bold; font-size:18px; }
.metric { font-size:16px; }
</style>
</head>
<body>
<div class="container">
<h1>Machine Health Dashboard</h1>
<div id="machine-status" class="card"><p class="label">Status: <span id="status-text">Loading...</span></p></div>
<div class="card"><p class="metric">Temperature: <span id="temp">--</span> Â°C</p></div>
<div class="card"><p class="metric">RMS: <span id="rms">--</span></p></div>
<div class="card"><p class="metric">Peak: <span id="peak">--</span></p></div>
<div class="card"><p class="metric">Health Index (HI): <span id="hi">--</span></p></div>
</div>
<script>
async function fetchCSVData() {
    try {
        const res = await fetch('/latest.csv');
        const csvText = await res.text();
        const lines = csvText.split("\n");
        const headers = lines[0].split(",");
        const lastLine = lines[lines.length-2].split(",");

        const idxTemp = headers.indexOf("TempC");
        const idxRMS  = headers.indexOf("RMS");
        const idxPeak = headers.indexOf("Peak");
        const idxHI   = headers.indexOf("HealthIndex");
        const idxStatus = headers.indexOf("Status");

        document.getElementById("temp").textContent = parseFloat(lastLine[idxTemp]).toFixed(2);
        document.getElementById("rms").textContent  = parseFloat(lastLine[idxRMS]).toFixed(3);
        document.getElementById("peak").textContent = parseFloat(lastLine[idxPeak]).toFixed(3);
        document.getElementById("hi").textContent   = parseFloat(lastLine[idxHI]).toFixed(2);

        const statusText = lastLine[idxStatus];
        const statusBox = document.getElementById("machine-status");
        statusBox.className = "card"; 
        if(statusText==="Healthy") statusBox.classList.add("status-healthy");
        else if(statusText==="Warning") statusBox.classList.add("status-warning");
        else statusBox.classList.add("status-faulty");

        document.getElementById("status-text").textContent = statusText;
    } catch(err){ console.error("Error fetching CSV:", err); }
}

// Initial fetch + repeat every 5 seconds
fetchCSVData();
setInterval(fetchCSVData,5000);
</script>
</body>
</html>
